{% extends 'index.html' %}
{% block ace-content %}
<style type="text/css"> 
	td.details-control {
	    background: url('/static/img/details_open.png') no-repeat center center;
	    cursor: pointer;
	}
	tr.shown td.details-control {
	    background: url('/static/img/details_close.png') no-repeat center center;
	} 
</style>	
{% endblock %}
{% block page-content %}
<div id="page-wrapper">
    <div class="row">
         <div class="col-lg-12">
              <h1 class="page-header"><i class="fa  fa-align-justify "></i> 游戏服清单</h1>
         </div>
                <!-- /.col-lg-12 -->
         
    </div>
	<div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-desktop fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{{totalProject}}</div>
                                    <div>总游戏服数</div>
                                </div>
                            </div>
                        </div>
                        <a href="#">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-green">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-laptop fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{{uatProject}}</div>
                                    <div>已上线</div>
                                </div>
                            </div>
                        </div>
                        <a href="#">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-red">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-mobile-phone fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{{sitProject}}</div>
                                    <div>已下架</div>
                                </div>
                            </div>
                        </div>
                        <a href="#">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
     </div>     
    <div class="row">
         <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            	<i class="fa fa-database"></i>明细清单
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <table width="100%" class="table table-striped table-bordered table-hover" id="ghostTableList">
                                <thead>
                                    <tr>
                                        <th class="text-center">详情</th>>
                                        <th class="text-center"><input type="checkbox" onclick="checkAllBox()"/>全选</th>
                                        <th class="text-center">产品线</th>
                                    	<th class="text-center">主机名称</th>
                                    	<th class="text-center">主机IP</th>
                                        <th class="text-center">操作系统</th>
                                        <th class="text-center">在运行游戏</th>
                                        <th class="text-center">激活状态</th>
                                        <th class="text-center">操作</th>
                                    </tr>
                                    <tfoot>
                                        <tr>
                                            <th class="text-center">详情</th>
                                            <th class="text-center">全选</th>
                                            <th class="text-center">产品线</th>
                                            <th class="text-center">主机名称</th>
                                            <th class="text-center">主机IP</th>
                                            <th class="text-center">操作系统</th>
                                            <th class="text-center">在运行游戏</th>
                                            <th class="text-center">激活状态</th>
                                            <th class="text-center">操作</th>
                                        </tr>
                                    </tfoot>
                                </thead>
                                <tbody>
                                	{% for gs in gs_host %}
                                            <tr class="odd gradeX">
                                                <td></td>
                                                <td class="text-center"><input type="checkbox" value={{gs.aid}} name="ckbox"/></td>
                                                <td>{{gs.business}} </td>
                                                <td>{{gs.hostname}} </td>
                                                <td>{{gs.ip}}</td>
                                                <td>{{gs.system}}</td>
                                                <td>{{gs.onlinegame}} </td>
                                                <td>{{gs.game}}</td>
                                                <td class="text-center">
									         		{% if gs.status == 0 %}
									         			<button  type="button" class="btn btn-outline btn-success">已上线</button>
									         		{% elif gs.status == 1 %}
									         			<button  type="button" class="btn btn-outline btn-primary">已下线</button>
									         		{% elif gs.status == 2 %}
									         			<button  type="button" class="btn btn-outline btn-warning">维修中</button>
									         		{% elif gs.status == 3 %}
									         			<button  type="button" class="btn btn-outline btn-info">已入库</button>
									         		{% elif gs.status == 4 %}
									         			<button  type="button" class="btn btn-outline btn-default">未使用</button>
									         		{% endif %}
									            </td>
                                                <td class="text-center">
                                                    <a href="/assets_view/{{gs.aid}}" style="text-decoration:none;"><button  type="button" class="btn btn-default"><abbr title="查看详细信息"><i class="glyphicon glyphicon-info-sign"></i></abbr></button></a>
                                                    <div class="btn-group">
                                                       <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                                           <span class="glyphicon glyphicon-refresh"></span>
                                                           <span class="caret"></span>
                                                       </button>
                                                        <ul class="dropdown-menu" role="menu">
                                                            <li>
                                                                <a href="javascript:" onclick='gamehostUpdate(this,{{gs.sid}},"{{gs.ip}}","setup")'>更新主体信息</a>
                                                            </li>
                                                            <li>
													      	    <a href="javascript:" onclick='gamehostUpdate(this,{{gs.sid}},"{{gs.ip}}","syncdata")'>扫描游戏信息</a>
                                                            </li>
                                                        </ul>
                                                    </div>

                                                    <a href="/assets_mod/{{gs.aid}}" style="text-decoration:none;"><button  type="button" class="btn btn-default"><abbr title="修改资料"><i class="glyphicon glyphicon-edit"></button></i></abbr></a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                </tbody>
                            </table>
                            <!-- /.table-responsive -->
                            <div class="well">
                                <h4>添加说明</h4>
                                <p>没有任何游戏的新云主机在添加第一个游戏后会添加在列表里。</p>
                                <a class="btn btn-default btn-lg btn-block" target="_blank" href="/gs_add"><i class="fa fa-plus-circle "></i>添加新的游戏服</a>
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
    </div>  
<script type="text/javascript">
    function checkAllBox(){
	  	var qcheck=document.getElementsByName("ckbox");
	  	for (var i = 0; i < qcheck.length; i++)
		  {
		    var checkbox = qcheck[i];
		    checkbox.checked = !selectState;
		  }
	  	selectState = !selectState;
	}

    $(document).ready(function() {
	    var table = $('#ghostTableList').DataTable( {
/* 	        "ajax": "../ajax/data/objects.txt", */
	        "columns": [
	            {
	                "className": 'details-control',
	                "orderable": false,
	                "data":      null,
	                "defaultContent": ''
	            },
	            { "data": "全选" },
	            { "data": "产品线" },
	            { "data": "主机名称" },
	            { "data": "主机IP" },
	            { "data": "操作系统" },
	            { "data": "在运行游戏" },
	            { "data": "激活状态" },
	            { "data": "操作" }
	        ],
	        "order": [[2, 'asc']]
	    } );

	    // Add event listener for opening and closing details
	    $('#ghostTableList tbody').on('click', 'td.details-control', function () {
	    	var dataList = [];
	        var tr = $(this).closest('tr');
	        var row = table.row( tr );
	        aId = row.data()["资产ID"];
	        $.ajax({
	            url : "/api/assets/info/"+aId+"/",
	            type : "post",
	            async : false,
	            data : {"id":aId},
	            dataType : "json",
	            success : function(result) {
	            	dataList = result.data;
	            }
	        });
/* 	    	console.log(dataList); */
	        if ( row.child.isShown() ) {
	            // This row is already open - close it
	            row.child.hide();
	            tr.removeClass('shown');
	        }
	        else {
	            // Open this row
	            row.child( format(dataList) ).show();
	            tr.addClass('shown');
	        }
	    } );
	} );

    function gamehostUpdate(obj, id,ip,type){
			var btnObj = $(obj);
			var txt=  "是否确认更新？";
			if (type==="setup"){
                var retitle="更新主机"+ip+")硬件信息"
                var reurl='/assets_facts/'
            }
            else if(type==="syncdata"){
                var retitle="更新主机"+ip+")游戏信息"
                var reurl='/gamehost_facts/'
            }
			var option = {
					title: retitle,
					btn: parseInt("0011",2),
					onOk: function(){
						$.ajax({
							  type: 'POST',
							  url: reurl,
							  data:{
									"ip":ip,
									"server_id":id,
									"type":type
								},
						      success:function(response){
					                if (response["code"]=="200"){
					                	window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.success);

					                }
						        	else{
						        		window.wxc.xcConfirm(response["msg"], window.wxc.xcConfirm.typeEnum.error);
						        	}
							},
				            error:function(response){
				            	window.wxc.xcConfirm("请求数据错误！", window.wxc.xcConfirm.typeEnum.error);
				            },
							});
					},
					onCancel:function(){
					},
					onClose:function(){
					}
				}
			window.wxc.xcConfirm(txt, "custom", option);
		}

</script>
{% endblock %}