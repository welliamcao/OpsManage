{% extends 'index.html' %}
{% block page-content %}
<div id="page-wrapper">
    <div class="row">
         <div class="col-lg-12">
              <h1 class="page-header"><i class="fa  fa-print "></i>CDN操作记录</h1>
         </div>
                <!-- /.col-lg-12 -->
    </div>
	<div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                           	<i class="fa   fa-gear"></i> 操作日志
                        </div>
                        <div class="panel-body">

				                            
				           <ul class="nav nav-tabs">
				              <li class="active"><a href="#refresh" data-toggle="tab"><i class="fa fa-cubes"></i> 刷新记录</a>
				              </li>
			              
				           </ul>
				
				                            
				           <div class="tab-content">
				              <div class="tab-pane fade in active" id="refresh">
				                   <div class="row">
				                   		<div class="col-lg-12">
				                   			<br>
				                   			<div class='col-sm-8'> 
				                   			</div>
										    <div class='col-sm-2'>  
										        <div class="form-group">   
										            <div class='input-group'>  
										                <input  type="text"  id="RefreshLogStartTime"  class="form-control form_datetime" data-date-format="yyyy-mm-dd" placeholder="开始时间">
										                <span class="input-group-addon">  
										                    <span class="glyphicon glyphicon-calendar"></span>  
										                </span> 										                
										            </div>  
										        </div> 	
										    </div>
										    <div class='col-sm-2'>									    
										        <div class="form-group">    
										            <div class='input-group'>  
										                <input  type="text" id="RefreshLogEndTime"   class="form-control form_datetime" data-date-format="yyyy-mm-dd"  placeholder="结束时间">
										                <span class="input-group-addon" onclick="QueryRfreshRecord(this)">
										                    <span class="glyphicon glyphicon-search"></span>  										                    
										                </span> 																							                
										            </div>  
										        </div>  
										    </div> 											                   			
				                   		</div>
				                   		<div class="col-lg-12">
				                   			<br>
                                            <div style="height: 600px; overflow:scroll;">
                                                <table width="100%" class="table table-striped table-bordered table-hover" id="refreshTableList">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">刷新记录</th>
                                                            <th class="text-center">刷新类型</th>
                                                            <th class="text-center">提交时间</th>
                                                            <th class="text-center">刷新状态</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="odd">
                                                            <td valign="top" colspan="8" class="dataTables_empty text-center">No data available in table</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
										</div>
				                   </div>
				              </div>				           
				              <div class="tab-pane fade" id="prehot">
				                   <div class="row">
				                   		<div class="col-lg-12">
				                   			<br>
				                   			<div class='col-sm-8'> 
				                   			</div>
										    <div class='col-sm-2'>  
										        <div class="form-group">   
										            <div class='input-group'>  
										                <input  type="text"  id="PrehotLogStartTime"  class="form-control form_datetime" data-date-format="yyyy-mm-dd" placeholder="开始时间">
										                <span class="input-group-addon">  
										                    <span class="glyphicon glyphicon-calendar"></span>  
										                </span> 										                
										            </div>  
										        </div> 	
										    </div>
										    <div class='col-sm-2'>									    
										        <div class="form-group">    
										            <div class='input-group'>  
										                <input  type="text" id="PrehotLogEndTime"   class="form-control form_datetime" data-date-format="yyyy-mm-dd"  placeholder="结束时间">
										                <span class="input-group-addon" onclick="QueryPrehotRecord()">
										                    <span class="glyphicon glyphicon-search"></span>  										                    
										                </span> 																							                
										            </div>  
										        </div>  
										    </div> 											                   			
				                   		</div>				                   
				                   		<div class="col-lg-12">
				                   			<br>
                                            <div style="height: 600px; overflow:scroll;">
                                                <table width="100%" class="table table-striped table-bordered table-hover" id="prehotTableList">
                                                    <thead>
                                                        <tr>
                                                            <th class="text-center">预热记录</th>
                                                            <th class="text-center">提交时间</th>
                                                            <th class="text-center">预热状态</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
										</div>
				                   </div>
				              </div>
				              
				           </div>


                            <!-- /.row (nested) -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
</div>


<script type="text/javascript">

		$(".form_datetime").datetimepicker({format: 'yyyy-mm-dd'});

		function QueryRfreshRecord() {
			startTime = document.getElementById("RefreshLogStartTime").value;
			endTime = document.getElementById("RefreshLogEndTime").value;
			if( startTime.length==0 || endTime.length==0 ){
				window.wxc.xcConfirm("请注意选择时间", window.wxc.xcConfirm.typeEnum.error);
				return false;
			};
			$("#refreshTableList").children('tbody').html('<tr class="odd gradeX"><td>查询中，请等待...</td></tr>')
			$.ajax({
				dataType: "JSON",
				url:'/frontend/cdn/record?type=refresh',
				type:"POST",  //提交类似
				data:{
					"startTime":startTime,
					"endTime":endTime
				},
 				success:function(response){
				    response = JSON.parse(response);
					if (response.total > 0){
					    datalist=response['logs'];
				        var tableBodys = '';
						for(var i=0;i<datalist.length;i++){
						    if (datalist[i].status == "1") {
                                statushtml ='<td style="text-align:center"><button type="button" class="btn btn-outline btn-success">刷新成功</button></td>'
						    }
                            else if(datalist[i].status == "0"){
                               statushtml ='<td style="text-align:center"><button type="button" class="btn btn-outline btn-primary">刷新中</button></td>'
                            }
                            else {
			                    statushtml='<td style="text-align:center"><button type="button" class="btn btn-outline btn-danger">刷新失败</button></td>'
                            }

                            if (datalist[i].type == "0"){
                                typehtml = '<td class="text-center">URL</td>'
                            }
                            else if (datalist[i].type == "1"){
                                typehtml = '<td class="text-center">目录</td>'
                            }
	                    	tableBodys += '<tr class="odd gradeX"><td class="text-center">'+datalist[i].url_list+'</td>'
                                            +typehtml
                                            +'<td class="text-center">'+datalist[i].datetime+'</td>'
                                            +statushtml
                                        +'</tr>'
						};
					    $("#refreshTableList").children('tbody').html(tableBodys);
					}
					else{
						window.wxc.xcConfirm("未查询到相关数据", window.wxc.xcConfirm.typeEnum.error);
					}
				}	 			
			})					
		}		
		
		function QueryPrehotRecord() {
			startTime = document.getElementById("PrehotLogStartTime").value;
			endTime = document.getElementById("PrehotLogEndTime").value;
			if( startTime.length==0 || endTime.length==0 ){
				window.wxc.xcConfirm("请注意选择时间", window.wxc.xcConfirm.typeEnum.error);
				return false;
			};
			$.ajax({
				dataType: "JSON",
				url:'/frontend/cdn/record?type=prehot',
				type:"POST",  //提交类似
				data:{
					"startTime":startTime,
					"endTime":endTime
				},
 				success:function(response){
					if (response['data'].length > 0){	
				        var tableBodys = '';
						for(var i=0;i<response['data'].length;i++){
						    if (response['data'][i].status == 'done') {
                                statusHtml ='<button type="button" class="btn btn-outline btn-success">预热成功</button>'
						    }
                            else if(response['data'][i].status == 'process'){
                               statusHtml ='<button type="button" class="btn btn-outline btn-primary">预热中</button>'
                            }
                            else if(response['data'][i].status =='fail' ){
			                    statusHtml='<button type="button" class="btn btn-outline btn-danger">预热失败</button>'
                            }
                            else if(response['data'][i].status =='init' ){
			                    statusHtml='<button type="button" class="btn btn-outline btn-danger">初始化中</button>'
                            }
                            else if(response['data'][i].status =='queue' ){
			                    statusHtml='<button type="button" class="btn btn-outline btn-danger">预热队列等待中</button>'
                            }
	                    	tableBodys += '<tr><td class="text-center">'+response['data'][i].url+'</td>'
                                            +'<td class="text-center">'+response['data'][i].datetime+'</td>'
                                            +statusHtml
                                        +'</tr>'
						};
					    $("#prehotTableList").find('tbody').innerHTML = tableBodys;
					}
					else{
						window.wxc.xcConfirm("未查询到相关数据", window.wxc.xcConfirm.typeEnum.error);
					}
				}	 			
			})					
		}		

		$(document).ready(function() {
		});

</script>

{% endblock %}